<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Rust AST Explorer</title>
</head>

<body>

    <table width="100%" border="0">
        <tbody>
            <tr>
                <td></td>
                <td width="700">
                    <h2 style="text-align:center">Rust AST Explorer</h2>
                    <p>Paste Rust code</p>
                    <textarea onkeypress="clickPress(event)" rows="5" cols="80" id="end"
                        placeholder="fn main() { println!(); }"></textarea>

                    <p><button id="yields">Go!</button></p>
                    <div style="  display: block;
                                                font-family: monospace;
                                                white-space: pre;
                                                margin: 1em 0;" id="result">...</div>
                    <p><a href="https://github.com/CarlKCarlK/rust-ast-explorer">
                            https://github.com/CarlKCarlK/rust-ast-explorer</p>
                </td>
                <td></td>
            </tr>
        </tbody>
    </table>

    <script type="module">
        import init, { greet, search } from "./pkg/rust_ast_explorer.mjs";
        init()
            .then(() => {
                // alert("Error: Must be a positive integer")
                // greet("WebAssembly")
                // alert(search(20));
            });

        function fifths() { // todo rename
            var end_string = document.getElementById('end').value
            if (end_string == "") { end_string = "fn main() { println!(); }"; }
            document.getElementById('result').innerHTML = "<em>working</em>";
            setTimeout(() => {
                // todo rename search and end_string
                var result = search(end_string);
                // alert(result)
                document.getElementById('result').innerHTML = result;
            }, 0);
        }

        function clickPress(event) {
            if (event.keyCode == 13) {
                fifths();
            }
        }


        document.getElementById('yields').addEventListener('click', fifths);
        document.getElementById('end').addEventListener('keyup', clickPress);

    </script>

</body>

</html>